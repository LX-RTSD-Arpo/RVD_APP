<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 STRICT//EN" "DTD/xhtml1-strict.dtd">
<html>

<head>
    <title>RVD-Field Web Management</title>
    <link href="/static/mchp.css" rel="stylesheet" type="text/css" />
    <script src="/static/mchp.js" type="text/javascript"></script>
    <script src="/static/javascriptMD5.js" type="text/javascript"></script>
</head>

<body onLoad="allowAJAX=true;" onUnload="allowAJAX=false;">
    <div id="shadow-one">
        <div id="shadow-two">
            <div id="shadow-three">
                <div id="shadow-four">
                    <div id="page">
                        <div style="padding:0 0 5px 5px"><img src="/static/logo.gif" /></div>
                        <div id="title">
                            <div class="right">RVD-Field Processor</div><span id="hello">&nbsp;</span>
                            <div class="left">NTP Setting</div><span id="hello">&nbsp;</span>
                        </div>

                        <div id="menu">
                            <a href="/static/index.html" onclick="allowAJAX=false;">Home</a>
                            <a href="/static/network.html" onclick="allowAJAX=false;">TCP/IP Setting</a>
                            <!--<a href="/static/radarconfig.html" onclick="allowAJAX=false;">RVD Interface</a>-->
                            <a href="/static/control.html" onclick="allowAJAX=false;">Relay Control</a>
                            <a href="/static/firmware.html" onclick="allowAJAX=false;">Firmware</a>
                            <a href="/static/ntp.html" onclick="allowAJAX=false;">NTP Setting</a>
                            <a href="/static/support.html" onclick="allowAJAX=false;">Support</a>
                            <a href="/logout" onclick="confirm('คุณแน่ใจหรือไม่ว่าจะออกจากระบบ?');">Logout</a>
                        </div>

                        <div id="content">
                            <div class="examplebox">
                                <table align="center">
                                    <tr>
                                        <td colspan="3" align="center" valign="middle">
                                            <div align="center"><b>------------------- Current Setting -------------------</b></div>
                                            <div align="center"></div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td width="256"><b>NTP server:</b></td>
                                        <td width="220" id="titlex"><span id="ntp_priserver" required>กำลังโหลด...</span></td>
                                    </tr>
                                    <!-- <tr>
                                        <td><b>Secondary server:</b></td>
                                        <td id="titlex">~ntp_secserver~</td>
                                    </tr> -->
                                    <tr>
                                        <td>&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td><b>NTP status</b></td>
                                        <td id="titlex"><span id="ntp_status" required>กำลังโหลด...</span></td>
                                    </tr>
                                    <tr>
                                        <td>&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td><b>Automatic synchronize :</b></td>
                                        <td id="titlex"><span id="ntp_autosync" required>กำลังโหลด...</span></td>
                                    </tr>
                                    <tr>
                                        <td><b>Time synchronize (min.) </b></td>
                                        <td id="titlex"><span id="ntp_timesync" required>กำลังโหลด...</span></td>
                                    </tr>
                                    <tr>
                                        <td><b> Time out (attempts) </b></td>
                                        <td id="titlex"><span id="ntp_timeout" required>กำลังโหลด...</span></td>
                                    </tr>
                                    <tr>
                                        <td>&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td>&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" align="center" valign="middle">
                                            <div align="center"><b>------------------- New Setting -------------------</b></div>
                                            <div align="center"></div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td width="240"><b>NTP server:</b></td>
                                        <td><input name="ntp_priserver" type="text" id="ntppriserver" maxlength="15" required />
                                        </td>
                                    </tr>
                                    <!-- <tr>
                                        <td><b>Secondary server:</b></td>
                                        <td><input name="ntpsecserver" type="text" id="ntpsecserver"
                                                value="~ntp_secserver~" maxlength="15" /></td>
                                    </tr> -->
                                    <tr>
                                        <td>&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td><b>Automatic synchronize :</b></td>
                                        <td><select name="Autosync" id="ntpautosync" style="width:160px">
                                                <option value=1 ~ntp_automatsync~>ON</option>
                                                <option value=0 ~ntp_automatsync~>OFF</option>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td><b>Time synchronize (min.): </b></td>
                                        <td><input name="ntptimesync" type="text" id="ntptimesync" maxlength="5" required />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><b> Time out (attempts) : </b></td>
                                        <td><input name="ntptimeout" type="text" id="ntptimeout" maxlength="5" required />
                                        </td>
                                    </tr>
                                    <!-- <tr>
                                        <td><b>Display Dimmer (Level 0-8):</b></td>
                                        <td><select name="ntpdimmer" id="select" style="width:160px">
                                                <option value="0" ~ntp_dimmer~>Level 0 (Off)</option>
                                                <option value="1" ~ntp_dimmer~>Level 1</option>
                                                <option value="2" ~ntp_dimmer~>Level 2</option>
                                                <option value="3" ~ntp_dimmer~>Level 3</option>
                                                <option value="4" ~ntp_dimmer~>Level 4</option>
                                                <option value="5" ~ntp_dimmer~>Level 5</option>
                                                <option value="6" ~ntp_dimmer~>Level 6</option>
                                                <option value="7" ~ntp_dimmer~>Level 7</option>
                                                <option value="8" ~ntp_dimmer~>Level 8</option>
                                                <option value="9" ~ntp_dimmer~>Auto-dimming</option>
                                            </select></td>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>&nbsp;</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td><b>Time Format :</b></td>
                                        <td><select name="ntptimeformat" id="select" style="width:160px">
                                                <option value="0" ~time_format~>12-hour time</option>
                                                <option value="1" ~time_format~>24-hour time</option>
                                            </select></td>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>&nbsp;</td>
                                        <td></td>
                                    </tr> -->
                                    <tr>
                                        <td colspan="3" align="center" valign="middle">&nbsp;</td>
                                    </tr>
                                    
                                </table>

                                <button onclick="SetNTPSetting()" style="height:30px; width:180px; margin-bottom: 10px;">-- Apply Setting --</button>
                            </div>

                            <div id="current-settings">
                                <p></p>
                            </div>

                            <script>
                                async function fetchCurrentNTPSettings() {
                                    try {
                                        const response = await fetch('/get-ntp-settings');
                                        const data = await response.json();
                                        if (response.ok) {
                                            document.getElementById('ntp_priserver').innerText = data.ntp_priserver;
                                            document.getElementById('ntp_status').innerText = data.ntp_status;
                                            document.getElementById('ntp_autosync').innerText = data.ntp_autosync;
                                            document.getElementById('ntp_timesync').innerText = data.ntp_timesync;
                                            document.getElementById('ntp_timeout').innerText = data.ntp_timeout;
                                        } else {
                                            document.getElementById('current-settings').innerHTML = `<p>เกิดข้อผิดพลาด: ${data.error}</p>`;
                                        }
                                    } catch (error) {
                                        document.getElementById('current-settings').innerHTML = `<p>เกิดข้อผิดพลาดในการเชื่อมต่อ: ${error.message}</p>`;
                                    }
                                }

                                async function SetNTPSetting() {
                                    event.preventDefault(); // ป้องกันการรีเฟรชหน้า
                                    const ntppriserver = document.getElementById('ntppriserver').value;
                                    const ntpautosync = document.getElementById('ntpautosync').value;
                                    const ntptimesync = document.getElementById('ntptimesync').value;
                                    const ntptimeout = document.getElementById('ntptimeout').value;

                                    const response = await fetch('/set-ntp-settings', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({ ntppriserver, ntpautosync, ntptimesync, ntptimeout})
                                    });

                                    const data = await response.json();
                                    if (response.ok) {
                                        alert('บันทึกการตั้งค่าเรียบร้อยแล้ว!');
                                    } else {
                                        alert(`เกิดข้อผิดพลาด: ${data.error}`);
                                    }
                                }

                                initializeIdleLogoutHandler(300);
                                
                                fetchCurrentNTPSettings();
                            </script>
                        </div>

                        <div class="spacer">&nbsp;</div>
                        <div id="footer">Copyright &copy; 2024 Loxley Public Company Limited, Inc.</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>