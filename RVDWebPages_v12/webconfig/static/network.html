<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 STRICT//EN" "DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>RVD-Field Web Management</title>
    <link href="/static/mchp.css" rel="stylesheet" type="text/css" />
    <script src="/static/mchp.js" type="text/javascript"></script>
    <script src="/static/javascriptMD5.js" type="text/javascript"></script>
</head>

<body onLoad="allowAJAX=true;" onUnload="allowAJAX=false;">
<div id="shadow-one">
    <div id="shadow-two">
        <div id="shadow-three">
            <div id="shadow-four">
                <div id="page">
                    <div style="padding:0 0 5px 5px"><img src="/static/logo.gif" /></div>
                    <div id="title"><div class="right">RVD-Field Processor</div><span id="hello">&nbsp;</span></div>

                    <div id="menu">
                        <a href="/static/index.html" onclick="allowAJAX=false;">Home</a>
                        <!-- <a href="/static/useraccount.html" onclick="allowAJAX=false;">User Accounts</a> -->
                        <a href="/static/network.html" onclick="allowAJAX=false;">TCP/IP Setting</a>
                        <!-- <a href="/static/firmware.html" onclick="allowAJAX=false;">Firmware</a> -->
                        <a href="/static/support.html" onclick="allowAJAX=false;">Support</a>
                    </div>

                    <div id="content">
                        <form id="network-form">
                            <div class="examplebox">
                                <table align="center">
                                    <tr><td><b>Host Name:</b></td>
                                        <td><input type="text" id="host" maxlength="15" name="host" required /></td></tr>
                                    <tr><td>&nbsp;</td><td></td></tr>
                                    <tr><td width="200"><b>IP Address:</b></td>
                                        <td width="150"><input type="text" id="ip" maxlength="15" name="ip" required /></td></tr>
                                    <tr><td><b>Gateway:</b></td>
                                        <td><input type="text" id="gateway" maxlength="15" name="gateway" required /></td></tr>
                                    <tr><td><b>Subnet Mask:</b></td>
                                        <td><input type="text" id="subnet_mask" maxlength="15" name="subnet_mask" required /></td></tr>
                                    <tr><td><b>Primary DNS:</b></td>
                                        <td><input type="text" id="primary_dns" maxlength="15" name="primary_dns" required /></td></tr>
                                    <tr><td><b>Secondary DNS:</b></td>
                                        <td><input type="text" id="secondary_dns" maxlength="15" name="secondary_dns" required /></td></tr>
                                    <tr>
                                        <td height="25" colspan="3" align="center" valign="middle">
                                            <div align="center"><b>--------------------------------------</b></div>
                                        </td>
                                    </tr>
                                </table>
                                <div align="center">
                                    <input type="submit" value="-- Update Settings --" style="height:30px; width:180px;"/>
                                </div>
                            </div>
                        </form>

                        <div id="current-settings">
                            <p>กำลังโหลดการตั้งค่า...</p>
                        </div>

                        <script>
                            // ฟังก์ชันสำหรับดึงการตั้งค่าปัจจุบัน
                            async function fetchCurrentSettings() {
                                try {
                                    const response = await fetch('/get-network-settings');
                                    const data = await response.json();
                                    if (response.ok) {
                                        document.getElementById('current-settings').innerHTML = ``/*`
                                            <p>Host: ${data.host}</p>
                                            <p>IP Address: ${data.ip}</p>
                                            <p>Gateway: ${data.gateway}</p>
                                            <p>Subnet Mask: ${data.subnet_mask}</p>
                                            <p>Primary DNS: ${data.primary_dns}</p>
                                            <p>Secondary DNS: ${data.secondary_dns}</p>
                                        `*/;
                                        document.getElementById('host').value = data.host;
                                        document.getElementById('ip').value = data.ip;
                                        document.getElementById('gateway').value = data.gateway;
                                        document.getElementById('subnet_mask').value = data.subnet_mask;
                                        document.getElementById('primary_dns').value = data.primary_dns;
                                        document.getElementById('secondary_dns').value = data.secondary_dns;
                                    } else {
                                        document.getElementById('current-settings').innerHTML = `
                                            <p>เกิดข้อผิดพลาด: ${data.error}</p>
                                        `;
                                    }
                                } catch (error) {
                                    document.getElementById('current-settings').innerHTML = `
                                        <p>เกิดข้อผิดพลาดในการเชื่อมต่อ: ${error.message}</p>
                                    `;
                                }
                            }

                            // ฟังก์ชันสำหรับส่งการตั้งค่าใหม่
                            document.getElementById('network-form').addEventListener('submit', async (event) => {
                                event.preventDefault(); // ป้องกันการรีเฟรชหน้า
                                const host = document.getElementById('host').value;
                                const ip = document.getElementById('ip').value;
                                const gateway = document.getElementById('gateway').value;
                                const subnet_mask = document.getElementById('subnet_mask').value;
                                const primary_dns = document.getElementById('primary_dns').value;
                                const secondary_dns = document.getElementById('secondary_dns').value;

                                const response = await fetch('/set-network-settings', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({host, ip, gateway, subnet_mask, primary_dns, secondary_dns })
                                });

                                const data = await response.json();
                                if (response.ok) {
                                    alert('บันทึกการตั้งค่าเรียบร้อยแล้ว!');
                                    fetchCurrentSettings(); // รีเฟรชการตั้งค่า
                                } else {
                                    alert(`เกิดข้อผิดพลาด: ${data.error}`);
                                }
                            });

                            // เรียกใช้งานฟังก์ชันเพื่อโหลดการตั้งค่าตอนเริ่มต้น
                            fetchCurrentSettings();
                        </script>
                    </div>

                    <div class="spacer">&nbsp;</div>
                    <div id="footer">Copyright &copy; 2024 Loxley Public Company Limited, Inc.</div>

                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
